#Wordpress container
version: '3'
services:
#Database service
  db:
    image: mariadb:latest
    container_name: db-${CONTAINER_NAME}
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DATABASE}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}

    volumes:
      - "./mysql/datadir:/var/lib/mysql"
      - "./mysql/backup_mysql:/backup:ro"
      - /etc/localtime:/etc/localtime:ro
      - /etc/timezone:/etc/timezone:ro

    networks:
      - default

#Wordpress service
  wordpress:
    image: wordpress:latest
    container_name: wp-${CONTAINER_NAME}
    restart: unless-stopped
    environment:
      VIRTUAL_HOST: ${VIRTUAL_HOST}
#     VIRTUAL_PORT: ${VIRTUAL_PORT}
      LETSENCRYPT_HOST: ${LETSENCRYPT_HOST}
      LETSENCRYPT_EMAIL: ${LETSENCRYPT_EMAIL}
      WORDPRESS_DB_HOST: db:3306
      WORDPRESS_DB_USER: ${MYSQL_USER}
      WORDPRESS_DB_PASSWORD: ${MYSQL_PASSWORD}
      WORDPRESS_DB_NAME: ${MYSQL_DATABASE}
      WORDPRESS_TABLE_PREFIX: ${WORDPRESS_TABLE_PREFIX}
    volumes:
      - "./html:/var/www/html"
    depends_on:
      - db

    networks:
      - webproxy
      - default

  ftp-server:
    container_name: ftp-${CONTAINER_NAME}
    image: stilliard/pure-ftpd:hardened
    ports:
      - "2121:21"
      - "30000-30009:30000-30009"
    volumes:
      - "./html:/home/ftpusers/"
      - "./ftpd/passwd:/etc/pure-ftpd/passwd"
      - "./ftpd/ssl:/etc/ssl/private/"
    environment:
      PUBLICHOST: ${VIRTUAL_HOST}
      ADDED_FLAGS: "-g root"
    restart: unless-stopped

networks:
  webproxy:
    external:
      name: webproxy
